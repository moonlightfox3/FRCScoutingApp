<!doctype html>
<title>Server</title>
<link rel="icon" href="../icons/icon.svg">
<link rel="apple-touch-icon" sizes="1024x1024" href="../icons/apple-touch-icon-1024x1024.png">
<link rel="manifest" href="../manifest.json">
<link rel="stylesheet" href="../libs/style.css">
<link rel="stylesheet" href="./server-style.css">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script src="../libs/server.js"></script>

<a href="../index.html"><button id="backBtn">Back</button></a> | Server
<hr>
<span id="loadingEl">Connecting to server...</span><br>
<input id="emailInp" placeholder="Email" disabled><br>
<input type="password" id="passwordInp" placeholder="Password" disabled><br>
<button id="signInBtn" disabled>Sign in</button><br>
<br>
<button id="signOutBtn" disabled>Sign out</button>

<script src="../libs/swrun.js"></script>
<script src="../libs/install.js"></script>
<script>
    async function checkSignIn () {
        let signedIn = await isSignedInToSupabase()
        if (signedIn) {
            emailInp.value = ""
            passwordInp.value = ""
            signOutBtn.disabled = false
        } else {
            emailInp.disabled = false
            passwordInp.disabled = false
            signInBtn.disabled = false
        }

        loadingEl.innerText = `Signed ${signedIn ? "in" : "out"}`
        return signedIn
    }
    onSupabaseLoaded = async function () {
        await checkSignIn()
    }

    signInBtn.onclick = async function () {
        emailInp.disabled = true
        passwordInp.disabled = true
        signInBtn.disabled = true
        await signInToSupabase(emailInp.value, passwordInp.value)
        await checkSignIn()
    }
    signOutBtn.onclick = async function () {
        signOutBtn.disabled = true
        await signOutOfSupabase()
        await checkSignIn()
    }
</script>
